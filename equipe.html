<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>H Invest - Código de Convite</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .box {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    .label {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .linha {
      background: #222;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button {
      padding: 8px 12px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    h3 {
      margin-top: 20px;
    }
    .info-text {
      font-size: 14px;
      line-height: 1.5;
      color: #ccc;
    }
    ul {
      padding-left: 20px;
      list-style: disc;
      color: #ccc;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>

  <div class="box">
    <div class="label">Código de Convite</div>
    <div class="linha">
      <span id="codigo">Carregando...</span>
      <button onclick="copiarTexto('codigo')">Copiar</button>
    </div>

    <div class="label">Link de convite</div>
    <div class="linha">
      <span id="link">Carregando...</span>
      <button onclick="copiarTexto('link')">Copiar</button>
    </div>

    <div class="linha">
      <strong>Compartilhar</strong>
      <button onclick="compartilharWhatsApp()">WhatsApp</button>
    </div>

    <div class="label">Minha equipe</div>

    <h3>LV1</h3>
    <div class="linha"><span>26% Taxa de comissão</span></div>
    <div class="linha"><span id="lv1-qtd">0 Quantidade efetiva</span></div>
    <div class="linha"><span id="lv1-bonus">R$ 0,00 Bônus</span></div>

    <h3>LV2</h3>
    <div class="linha"><span>1% Taxa de comissão</span></div>
    <div class="linha"><span id="lv2-qtd">0 Quantidade efetiva</span></div>
    <div class="linha"><span id="lv2-bonus">R$ 0,00 Bônus</span></div>

    <h3>LV3</h3>
    <div class="linha"><span>1% Taxa de comissão</span></div>
    <div class="linha"><span id="lv3-qtd">0 Quantidade efetiva</span></div>
    <div class="linha"><span id="lv3-bonus">R$ 0,00 Bônus</span></div>

    <div class="linha"><strong>Número de equipe</strong><span id="totalEquipe">0</span></div>
    <div class="linha"><strong>Bônus total</strong><span id="total-bonus">R$ 0,00</span></div>

    <h3>Lista da equipe completa</h3>
    <ul id="listaEquipe"></ul>
    <p>Total de membros: <span id="totalMembros">0</span></p>
    <p>Comissão total: R$ <span id="totalComissao">0,00</span></p>
  </div>

  <div class="box">
    <h3>Prêmios de convite</h3>
    <div class="info-text">
      Quando os amigos que você convidar se inscreverem e investirem, você receberá imediatamente <strong>26%</strong> de comissão.<br><br>
      Quando os membros da sua equipe de nível 2 investirem, você receberá <strong>1%</strong> de comissão.<br><br>
      Quando os membros da sua equipe Nível 3 investirem, você receberá <strong>1%</strong> de comissão.<br><br>
      As comissões são creditadas diretamente no seu saldo e podem ser sacadas a qualquer momento.
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCKSKnVC8dNWmiMrNr1j4rMLfQTlOrqzVM",
      authDomain: "hinvest-f4354.firebaseapp.com",
      databaseURL: "https://hinvest-f4354-default-rtdb.firebaseio.com",
      projectId: "hinvest-f4354",
      storageBucket: "hinvest-f4354.appspot.com",
      messagingSenderId: "646397677016",
      appId: "1:646397677016:web:f05ca27a38439568bff6ad"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const telefone = localStorage.getItem("telefoneLogado");
    if (!telefone) {
      window.location.href = "index.html";
    }

    function copiarTexto(id) {
      const texto = document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(texto).then(() => alert("Copiado!"));
    }

    function compartilharWhatsApp() {
      const link = document.getElementById("link").textContent.trim();
      const texto = `Cadastre-se agora na H Invest e ganhe comissão: ${link}`;
      const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
      window.open(url, '_blank');
    }

    db.ref("usuarios/" + telefone).once("value").then(snapshot => {
      const user = snapshot.val();
      if (!user) return;

      const codigo = user.codigo || "1";
      document.getElementById("codigo").textContent = codigo;
      document.getElementById("link").textContent = `https://inves13.github.io/hivest-codigo-1/?codigo=${codigo}`;
    });

    db.ref("usuarios/" + telefone + "/equipe").once("value").then(snapshot => {
      if (!snapshot.exists()) return;

      let totalEquipe = 0;
      let totalBonus = 0;
      let lv1 = { qtd: 0, bonus: 0 };
      let lv2 = { qtd: 0, bonus: 0 };
      let lv3 = { qtd: 0, bonus: 0 };

      const listaUl = document.getElementById("listaEquipe");
      let totalComissao = 0;

      snapshot.forEach(child => {
        const item = child.val();
        totalEquipe++;

        const nivel = item.nivel;
        const bonus = parseFloat(item.bonus || 0);
        const nome = item.nome || "Sem nome";

        totalBonus += bonus;
        totalComissao += bonus;

        if (nivel === 1) {
          lv1.qtd++;
          lv1.bonus += bonus;
        } else if (nivel === 2) {
          lv2.qtd++;
          lv2.bonus += bonus;
        } else if (nivel === 3) {
          lv3.qtd++;
          lv3.bonus += bonus;
        }

        const li = document.createElement("li");
        li.textContent = `${nome} - Nível ${nivel} - Comissão: R$ ${bonus.toFixed(2).replace('.', ',')}`;
        listaUl.appendChild(li);
      });

      document.getElementById("lv1-qtd").textContent = `${lv1.qtd} Quantidade efetiva`;
      document.getElementById("lv1-bonus").textContent = `R$ ${lv1.bonus.toFixed(2).replace('.', ',')} Bônus`;
      document.getElementById("lv2-qtd").textContent = `${lv2.qtd} Quantidade efetiva`;
      document.getElementById("lv2-bonus").textContent = `R$ ${lv2.bonus.toFixed(2).replace('.', ',')} Bônus`;
      document.getElementById("lv3-qtd").textContent = `${lv3.qtd} Quantidade efetiva`;
      document.getElementById("lv3-bonus").textContent = `R$ ${lv3.bonus.toFixed(2).replace('.', ',')} Bônus`;

      document.getElementById("totalEquipe").textContent = totalEquipe;
      document.getElementById("total-bonus").textContent = `R$ ${totalBonus.toFixed(2).replace('.', ',')}`;
      document.getElementById("totalMembros").textContent = totalEquipe;
      document.getElementById("totalComissao").textContent = totalComissao.toFixed(2).replace('.', ',');
    });

  </script>
</body>
</html>

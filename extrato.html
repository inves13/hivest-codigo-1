<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Extrato de Retirada</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f5f7;
      padding: 30px;
      color: #333;
    }
    h2 {
      color: #007bff;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .pending {
      background-color: #ffc107;
      color: black;
    }
    .approved {
      background-color: #28a745;
      color: white;
    }
    .rejected {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>
<body>

<h2>Extrato de Retirada</h2>

<div id="retiradasContainer"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCKSKnVC8dNWmiMrNr1j4rMLfQTlOrqzVM",
    authDomain: "hinvest-f4354.firebaseapp.com",
    databaseURL: "https://hinvest-f4354-default-rtdb.firebaseio.com",
    projectId: "hinvest-f4354",
    storageBucket: "hinvest-f4354.appspot.com",
    messagingSenderId: "646397677016",
    appId: "1:646397677016:web:f05ca27a38439568bff6ad"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Função para mostrar extrato de retirada
  db.ref("usuarios").on("child_added", snapshot => {
    const telefone = snapshot.key;
    db.ref("usuarios/" + telefone + "/extratoRetirada").on("child_added", childSnapshot => {
      const retirada = childSnapshot.val();
      const statusClass = retirada.status === "Aprovado" ? "approved" :
                          (retirada.status === "Rejeitado" ? "rejected" : "pending");

      const valorRetirado = parseFloat(retirada.valor).toFixed(2);
      const recebimento = parseFloat(retirada.recebimento || 0).toFixed(2);
      const dataRetirada = retirada.ultimoCheckin || "Data não disponível";

      const container = document.getElementById("retiradasContainer");
      container.innerHTML += `
        <div class="card ${statusClass}">
          <b>Usuário:</b> ${telefone}<br>
          <b>Valor retirado:</b> R$${valorRetirado}<br>
          <b>Recebido:</b> R$${recebimento}<br>
          <b>Data:</b> ${dataRetirada}<br>
          <b>Status:</b> ${retirada.status || "Aguardando Aprovação"}
        </div>`;
    });
  });
</script>

</body>
</html>

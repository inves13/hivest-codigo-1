<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel Administrativo</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f5f7;
      padding: 30px;
      color: #333;
    }
    h2, h3 {
      color: #007bff;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      cursor: pointer;
      background-color: #007bff;
      color: white;
      border: none;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .danger {
      background-color: #dc3545;
    }
    .danger:hover {
      background-color: #b02a37;
    }
    .success {
      background-color: #28a745;
    }
    .success:hover {
      background-color: #1e7e34;
    }
    .gray {
      background-color: #6c757d;
    }
    .gray:hover {
      background-color: #5a6268;
    }
  </style>
</head>
<body>

<h2>Painel Administrativo</h2>

<h3>Usuários</h3>
<div id="usuariosContainer"></div>

<h3>Recargas Pendentes</h3>
<div id="recargasContainer"></div>

<h3>Saques Pendentes</h3>
<div id="saquesContainer"></div>

<h3>Retiradas Realizadas</h3>
<div id="retiradasContainer"></div>

<h3>Investimentos Realizados</h3>
<div id="investimentosContainer"></div>

<script>
  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCKSKnVC8dNWmiMrNr1j4rMLfQTlOrqzVM",
    authDomain: "hinvest-f4354.firebaseapp.com",
    databaseURL: "https://hinvest-f4354-default-rtdb.firebaseio.com",
    projectId: "hinvest-f4354",
    storageBucket: "hinvest-f4354.appspot.com",
    messagingSenderId: "646397677016",
    appId: "1:646397677016:web:f05ca27a38439568bff6ad"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Listagem de usuários
  db.ref("usuarios").on("value", snapshot => {
    const container = document.getElementById("usuariosContainer");
    container.innerHTML = "";
    snapshot.forEach(child => {
      const user = child.val();
      const telefone = child.key;
      const nome = user.nome || "(Sem nome)";
      const saldo = user.saldoConta || 0;
      const bloqueado = user.bloqueado ? "SIM" : "NÃO";
      const conta = user.contaBancaria;
      const email = user.email || "E-mail não cadastrado";  // Adicionando o e-mail aqui
      const dadosPix = conta ? `
        <b>Banco:</b><br>
        Titular: ${conta.nomeTitular}<br>
        Tipo: ${conta.tipoChave}<br>
        Chave PIX: ${conta.chavePix}<br>` : "Sem dados bancários.";
      container.innerHTML += `
        <div class="card">
          <b>Telefone:</b> ${telefone}<br>
          <b>Nome:</b> ${nome}<br>
          <b>E-mail:</b> ${email}<br>  <!-- Exibindo o e-mail aqui -->
          <b>Saldo na Conta:</b> R$${saldo.toFixed(2)}<br>
          <b>Bloqueado:</b> ${bloqueado}<br><br>
          ${dadosPix}<br>
          <button class="success" onclick="adicionarSaldo('${telefone}')">Adicionar Saldo</button>
          <button class="danger" onclick="removerUsuario('${telefone}')">Remover Usuário</button>
          <button class="gray" onclick="bloquearUsuario('${telefone}')">Bloquear Usuário</button>
        </div>`;
    });
  });

  // Adicionar saldo
  function adicionarSaldo(telefone) {
    const valor = prompt("Digite o valor a ser adicionado:");
    if (valor && !isNaN(valor)) {
      db.ref("usuarios/" + telefone + "/saldoConta").once("value").then(snapshot => {
        const saldoAtual = snapshot.val() || 0;
        const saldoAtualizado = saldoAtual + parseFloat(valor);
        db.ref("usuarios/" + telefone).update({
          saldoConta: saldoAtualizado
        }).then(() => alert("Saldo adicionado com sucesso!"));
      });
    } else {
      alert("Valor inválido.");
    }
  }

  // Remover usuário
  function removerUsuario(telefone) {
    if (confirm("Tem certeza que deseja remover este usuário?")) {
      db.ref("usuarios/" + telefone).remove()
        .then(() => alert("Usuário removido com sucesso!"));
    }
  }

  // Bloquear usuário
  function bloquearUsuario(telefone) {
    if (confirm("Tem certeza que deseja bloquear este usuário?")) {
      db.ref("usuarios/" + telefone).update({
        bloqueado: true
      }).then(() => alert("Usuário bloqueado com sucesso!"));
    }
  }

  // Listagem de saques pendentes
  db.ref("saques").on("value", snapshot => {
    const container = document.getElementById("saquesContainer");
    container.innerHTML = "";
    snapshot.forEach(child => {
      const saque = child.val();
      if (saque.status === "pendente") {
        container.innerHTML += `
          <div class="card">
            <b>Usuário:</b> ${saque.userId}<br>
            <b>Valor:</b> R$${parseFloat(saque.valorSaque).toFixed(2)}<br>
            <b>Chave PIX:</b> ${saque.chavePix}<br>
            <b>Status:</b> ${saque.status}<br>
            <b>Recebimento:</b> ${saque.recebimento || "-"}<br>
            <button class="success" onclick="aprovarSaque('${child.key}')">Aprovar Saque</button>
            <button class="danger" onclick="rejeitarSaque('${child.key}')">Rejeitar Saque</button>
          </div>`;
      }
    });
  });

  function aprovarSaque(id) {
    if (confirm("Confirmar aprovação do saque?")) {
      db.ref("saques/" + id).update({ status: "aprovado" }).then(() => alert("Saque aprovado!"));
    }
  }

  function rejeitarSaque(id) {
    if (confirm("Confirmar rejeição do saque?")) {
      db.ref("saques/" + id).update({ status: "rejeitado" }).then(() => alert("Saque rejeitado!"));
    }
  }

  // Listagem de retiradas
  db.ref("usuarios").on("child_added", snapshot => {
    const telefone = snapshot.key;
    db.ref("usuarios/" + telefone + "/extratoRetirada").on("child_added", childSnapshot => {
      const retirada = childSnapshot.val();
      const retiradaKey = childSnapshot.key; // Pegando a chave do extratoRetirada
      const container = document.getElementById("retiradasContainer");

      container.innerHTML += `
        <div class="card" id="retirada-${retiradaKey}">
          <b>Usuário:</b> ${telefone}<br>
          <b>Valor:</b> R$${parseFloat(retirada.valor).toFixed(2)}<br>
          <b>Recebimento:</b> R$${parseFloat(retirada.recebimento).toFixed(2)}<br>
          <b>Último Checkin:</b> ${retirada.ultimoCheckin}<br>
          <button onclick="aprovarRetirada('${telefone}', '${retiradaKey}')">Aprovar Saque</button>
        </div>
      `;
    });
  });

  // Função para aprovar a retirada
  function aprovarRetirada(telefone, retiradaKey) {
    db.ref(`usuarios/${telefone}/extratoRetirada/${retiradaKey}`).update({
      status: "Aprovado"
    }).then(() => {
      alert("Retirada aprovada com sucesso!");
      // Atualiza a interface, se quiser
      const retiradaDiv = document.getElementById(`retirada-${retiradaKey}`);
      retiradaDiv.style.backgroundColor = "lightgreen";
    });
  }

  // Listagem de investimentos realizados
  db.ref("investimentos").on("value", snapshot => {
    const container = document.getElementById("investimentosContainer");
    container.innerHTML = "";
    snapshot.forEach(child => {
      const investimento = child.val();
      container.innerHTML += `
        <div class="card">
          <b>ID do Investimento:</b> ${child.key}<br>
          <b>Valor Investido:</b> R$${parseFloat(investimento.valorInvestido).toFixed(2)}<br>
          <b>Status:</b> ${investimento.status}<br>
          <b>Investidor:</b> ${investimento.usuario}<br>
        </div>`;
    });
  });
</script>

</body>
</html>
